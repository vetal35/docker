# Docker-Compose
- Это пример веб сервера на python который выводит на экран html файл 

- В нем продемонстрирована работа Docker-Compose
Создано два контейнера, в которых развернута плюс минус серверное приложения, запускал все через дестопный докер. 

# Первый контейнер это серверная часть

## index.html 
- Стандартный html файл для вывода текста на экран 


## server.py
- Импорт системных библиотек python
Эти библиотеки будут использоваться для создания веб-сервера
Эти библиотеки устанавливаются вместе с python
Сервер будем запустить на порте 6866
Благодаря этой команде сервер будет выполняться постоянно, ожидая запросов от клиента
```httpd.serve_forever()```


## Dockerfile
- Dockerfile всегда должен начинаться с импорта базового образа
Для этого используется ключевое слово 'FROM' 
Для того чтобы запустить в контейнере код, написанный на Python, нам нужно импортировать файлы `'server.py'` и `'index.html'`

- -Для того чтобы это сделать, мы используем ключевое слово `'ADD'`
Первый параметр, `'server.py'`, представляет собой имя файла, хранящегося на компьютере.

- Второй параметр, `'/server/'`, это путь, по которому нужно разместить указанный файл в образе.


- команда `'WORKDIR'`позволяет изменить рабочую директорию образа
В качестве такой директории, в которой будут выполняться все команды,  устанавливаем `'/server/'`

# Второй контейнер это клиентская часть 

## client.py 
- Импортируем системную библиотеку Python
Она используется для загрузки файла `'index.html'` с сервера
переменная содержит запрос к `'http://localhost:6866/'`

- `'encodedContent'` соответствует закодированному ответу сервера `('index.html')`

- `'decodedContent'` соответствует раскодированному ответу сервера (тут будет то, что мы хотим вывести на экран)

- Выводим содержимое файла, полученного с сервера `('index.html')`
Закрываем соединение с сервером

## Dockerfile
- То же самое, что и в серверном `Dockerfile`
Импортируем `'client.py'` в папку `'/client/'`
Устанавливаем в качестве рабочей директории `'/client/'`

## В итоге создано 2 контейнера собираем docker-compose.yml
- Файл docker-compose должен начинаться с тега версии
Следует учитывать, что docker-composes работает с сервисами
1 сервис = 1 контейнер
Раздел, в котором будут описаны сервисы, начинается с `'services'`

- - Первый сервис (контейнер): сервер

- Для именования соответствующего сервиса, используем ключевое слово `'server'`

- Ключевое слово `"build"` позволяет задать путь к файлу `Dockerfile`, который нужно использовать для создания образа,который позволит запустить сервис

- Здесь `'server/'` соответствует пути к папке сервера, которая содержит соответствующий `Dockerfile`

- Следующая команда означает запуск `"python ./server.py"`

- В качестве порта в `'server/server.py'` указан порт `6866`

- Делаем перенаправление этого порта на порт компьютера

- Сделать это поможет ключевое слово `'ports'`

- При его использовании применяется следующая конструкция: [порт компьютера]:[порт контейнера]

- В нашем случае нужно использовать порт компьютера `6866`и организовать его связь с портом `6866` контейнера (так как именно на этот порт сервер ожидает поступления запросов)


- Второй сервис (контейнер): сервис назван `'client'`
`'client/` соответствует пути к папке, которая содержит
файл `Dockerfile` для клиентской части системы

- Следующая команда означает запуск `"python ./client.py"`

- Ключевое слово `'network_mode'` используется для описания типа сети

- Указываем то, что контейнер может обращаться `'localhost'` компьютера

- Ключевое слово `'depends_on'` позволяет указывать, должен ли сервис, прежде чем запуститься, ждать, когда будут готовы к работе другие сервисы.
Нужно, чтобы сервис `'client'` дождался бы готовности к работе сервиса `'server'`


# И на финишной прямой 
- Необходимо забилдить(конечно при включенном docker)
`docker-compose build`

- И запускаем docker-compose `docker-compose up -d`

- проверяем `http://localhost:1234/`


# Шпаргалка по Docker Compose

### Сборка и запуск контейнеров

- `docker-compose up` – запуск контейнеров из `docker-compose.yml`
- `docker-compose up -d` – запуск контейнеров в фоновом режиме
- `docker-compose up --build` – пересборка контейнеров перед запуском

### Остановка и удаление контейнеров

- `docker-compose down` – остановка и удаление контейнеров из `docker-compose.yml`
- `docker-compose down -v` – остановка и удаление контейнеров и томов

### Управление контейнерами

- `docker-compose ps` – список запущенных контейнеров
- `docker-compose logs` – логи контейнеров
- `docker-compose exec <service-name> <command>` – выполнить команду внутри контейнера

### Переменные окружения

- `environment` – установка переменных окружения в `docker-compose.yml`
- `env_file` – установка переменных окружения из файла

### Сети

- `networks` – создание сети в `docker-compose.yml`
- `external` – подключение к внешней сети

### Тома

- `volumes` – создание томов в `docker-compose.yml`
- `external` – подключение к внешнему тому
